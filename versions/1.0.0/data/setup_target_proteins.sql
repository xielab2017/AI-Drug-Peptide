-- 创建目标蛋白数据库表
-- 用于存储要分析的蛋白质数据

-- 创建目标蛋白表
CREATE TABLE IF NOT EXISTS target_proteins (
    protein_id VARCHAR(50) PRIMARY KEY,
    protein_name VARCHAR(200) NOT NULL,
    gene_name VARCHAR(100),
    sequence TEXT NOT NULL,
    molecular_weight DECIMAL(10, 3),
    pi_value DECIMAL(5, 3),
    organism VARCHAR(100) DEFAULT 'Homo sapiens',
    uniprot_id VARCHAR(20),
    pdb_id VARCHAR(10),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_target_proteins_gene_name ON target_proteins(gene_name);
CREATE INDEX IF NOT EXISTS idx_target_proteins_organism ON target_proteins(organism);
CREATE INDEX IF NOT EXISTS idx_target_proteins_uniprot_id ON target_proteins(uniprot_id);

-- 插入示例数据（用于测试）
INSERT INTO target_proteins (
    protein_id, protein_name, gene_name, sequence, 
    molecular_weight, pi_value, organism, uniprot_id, pdb_id
) VALUES 
(
    'INS_HUMAN', 
    'Insulin', 
    'INS', 
    'MALWMRLLPLLALLALWGPDPAAAFVNQHLCGSHLVEALYLVCGERGFFYTPKTRREAEDLQVGQVELGGGPGAGSLQPLALEGSLQKRGIVEQCCTSICSLYQLENYCN',
    11570.5,
    5.5,
    'Homo sapiens',
    'P01308',
    '1MSO'
),
(
    'GH1_HUMAN',
    'Growth hormone 1',
    'GH1',
    'FPITPQIQPTSSPSAKSSSKPKKSKRKKSRSPFQPLPPYAQKPQKYSICFSEIPTPSNREEQFNQGRALLISLLLIQSLLHPVTNLSEFQKAQTLAVGMLQSMQGAGSGSLLAPANQLQFLRHFNHTFDTTSQEFDEAYIRDLQNYLQEVLISVILLSIWEQISVRSIFLEFQLLFNSNQKRLLGRDTYSDLQNRRLLLQDLVGLFCTDVLEVDKIRLIQLLHMFVHQFSEKISAYGVSHDVLVLLSLVILALHLHDFSHSQKLLQQILDTLAGLEAEPLQTPAQYQDLFMAIVLDLLHLHLLHQLNMDQVPPEKDLAQLIVCRSVEGSCGF',
    22124.4,
    6.9,
    'Homo sapiens',
    'P01241',
    '1AQH'
),
(
    'APOA1_HUMAN',
    'Apolipoprotein A-I',
    'APOA1',
    'MKWVTFISLLFLFSSAYSGVSRDWRKDLATVYVDVLKDSGRDYVSQFEGSALGKQLNKLFAVDLEPTVEIDRLMEDVRKGQDLFQNLAADAFVNALLSRFQSGWERLLLTGFLETLGKQGRVLANFFALPVDLDNSTEHAQKMVKEAVQAELQEVTQGNTHLEGKEDFKAHYKLSVGEVRLQGILTQVLSNKQTLQEKGLMKLEQVQGGIRLKDLQGMQDDLERQKMEHLFSQLEKLRLVSVQGQLPGQLKVQILQEELKEKDKQTLQEEDQQLKEKVLDQIAKVQDRAKQAQLELQKEAQMLEQLLNKQQLQKQKQEQKLQEELDKLDGLKSLRQLQVLKQQLKDVAKDQKLLKEQLQLQKEVQQLQLEQLQELQLEQLQKLQLEQQLQQLQKEVLQEQQLQKEQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQEQQLQ',
    29728.0,
    5.5,
    'Homo sapiens',
    'P02647',
    '1KWP'
);

-- 创建更新触发器
CREATE OR REPLACE FUNCTION update_target_proteins_timestamp()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_target_proteins_update_timestamp
    BEFORE UPDATE ON target_proteins
    FOR EACH ROW
    EXECUTE FUNCTION update_target_proteins_timestamp();

-- 添加注释
COMMENT ON TABLE target_proteins IS '存储蛋白质基本信息和分析数据';
COMMENT ON COLUMN target_proteins.protein_id IS '蛋白质唯一标识符';
COMMENT ON COLUMN target_proteins.protein_name IS '蛋白质名称';
COMMENT ON COLUMN target_proteins.gene_name IS '基因名称';
COMMENT ON COLUMN target_proteins.sequence IS '蛋白质氨基酸序列';
COMMENT ON COLUMN target_proteins.molecular_weight IS '分子量 (Da)';
COMMENT ON COLUMN target_proteins.pi_value IS '等电点';
COMMENT ON COLUMN target_proteins.organism IS '来源物种';
COMMENT ON COLUMN target_proteins.uniprot_id IS 'UniProt数据库编号';
COMMENT ON COLUMN target_proteins.pdb_id IS 'PDB结构编号';
